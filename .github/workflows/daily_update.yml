name: Daily AI Stock Update

on:
  schedule:
    # è¨­å®šæ™‚é–“ï¼šæ¯å¤© UTC æ™‚é–“ 22:30 åŸ·è¡Œ (å¤§ç´„æ˜¯ç¾æ±æ™‚é–“ä¸‹åˆ 5:30 æ”¶ç›¤å¾Œï¼Œå°ç£æ™‚é–“æ—©ä¸Š 6:30)
    # 1-5 ä»£è¡¨é€±ä¸€åˆ°é€±äº”åŸ·è¡Œ
    - cron: '30 22 * * 1-5'
  workflow_dispatch: # å…è¨±ä½ åœ¨ GitHub ç¶²é ä¸Šæ‰‹å‹•é»æ“ŠåŸ·è¡Œæ¸¬è©¦

jobs:
  update-data:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9' # è¨­å®š Python ç‰ˆæœ¬

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Run Market Scanner & Backtests
      run: |
        # 1. æ›´æ–° Tab 3 & 4 çš„æœ€æ–° AI æƒæåå–®
        python ai_market_scanner.py
        
        # 2. å¦‚æœä½ æœ‰æ¯å¤©æ›´æ–° Tab 1 & Tab 2 (ç¶“å…¸ç¦¿é·¹) çš„è…³æœ¬ï¼Œè«‹åœ¨é€™è£¡åŠ å…¥
        # ä¾‹å¦‚ï¼špython run_vulture_strategies.py
        
        # 3. åŸ·è¡Œç­–ç•¥å›æ¸¬ (æ›´æ–°è³‡é‡‘æ›²ç·š CSV)
        # æ³¨æ„ï¼šå¦‚æœå›æ¸¬è¦è·‘å¾ˆä¹…(è¶…é15åˆ†é˜)ï¼Œå»ºè­°ä¸è¦æ¯å¤©è·‘ï¼Œæˆ–åªè®“å®ƒè¨ˆç®—ç•¶å¤©æœ€æ–°æ·¨å€¼
        python ai_backtest_2.py
        python ai_backtest_ma30_2.py

    - name: Commit and Push changes
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action Bot"
        # åªæŠŠ data è³‡æ–™å¤¾åº•ä¸‹çš„è®Šæ›´åŠ å…¥
        git add data/
        # å¦‚æœå› ç‚ºæ²’é–‹å¸‚å°è‡´æ•¸æ“šæ²’è®Šï¼Œå°±ä¸æœƒå ±éŒ¯
        git commit -m "ğŸ¤– Auto-update daily stock data" || exit 0
        git push